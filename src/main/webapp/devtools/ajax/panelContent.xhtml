<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<div xmlns="http://www.w3.org/1999/xhtml"   
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
  xmlns:rl="http://xmlns.recursiveloop.org/cms"
  xmlns:rlc="http://java.sun.com/jsf/composite/components">

  <!-- query parameters -->
  <c:set var="pType" value="#{ request.getParameter('type') }" scope="request"/> <!-- optional -->
  <c:set var="pField" value="#{ request.getParameter('field') }" scope="request"/> <!-- optional -->
  <c:set var="pWidget" value="#{ request.getParameter('widget') }" scope="request"/> <!-- optional -->
  <c:set var="pJcrType" value="#{ request.getParameter('jcrtype') }" scope="request"/> <!-- optional -->

  <c:if test="#{ pType != null }">
    <c:set var="type" value="#{ jcrBean.getType(pType) }" scope="request"/>

    <c:if test="#{ pField != null and pField != '[new]' }">
      <c:set var="activeField" value="#{ type.getField(pField) }"/>

      <c:if test="#{ pWidget == null }">
        <c:set var="pWidget" value="#{ activeField.widget }"/>
      </c:if>

      <c:if test="#{ pJcrType == null }">
        <c:set var="pJcrType" value="#{ activeField.jcrType }"/>
      </c:if>
    </c:if>

    <c:choose>
      <c:when test="#{ pJcrType eq jcrBean.binary }">
        <c:set var="jcrTypeName" value="#{ 'Binary' }"/>
      </c:when>
      <c:when test="#{ pJcrType eq jcrBean.boolean }">
        <c:set var="jcrTypeName" value="#{ 'Boolean' }"/>
      </c:when>
      <c:when test="#{ pJcrType eq jcrBean.date }">
        <c:set var="jcrTypeName" value="#{ 'Date' }"/>
      </c:when>
      <c:when test="#{ pJcrType eq jcrBean.double }">
        <c:set var="jcrTypeName" value="#{ 'Double' }"/>
      </c:when>
      <c:when test="#{ pJcrType eq jcrBean.long }">
        <c:set var="jcrTypeName" value="#{ 'Long' }"/>
      </c:when>
      <c:when test="#{ pJcrType eq jcrBean.string }">
        <c:set var="jcrTypeName" value="#{ 'String' }"/>
      </c:when>
    </c:choose>

    <c:choose>
      <c:when test="#{ pWidget eq 'textedit' }">
        <c:set var="widgetName" value="#{ 'Textedit' }"/>
      </c:when>
      <c:when test="#{ pWidget eq 'textarea' }">
        <c:set var="widgetName" value="#{ 'Textarea' }"/>
      </c:when>
      <c:when test="#{ pWidget eq 'datepicker' }">
        <c:set var="widgetName" value="#{ 'Datepicker' }"/>
      </c:when>
      <c:when test="#{ pWidget eq 'spinbox' }">
        <c:set var="widgetName" value="#{ 'Spinbox' }"/>
      </c:when>
      <c:when test="#{ pWidget eq 'selector' }">
        <c:set var="widgetName" value="#{ 'Selector' }"/>
      </c:when>
      <c:when test="#{ pWidget eq 'checkbox' }">
        <c:set var="widgetName" value="#{ 'Checkbox' }"/>
      </c:when>
      <c:when test="#{ pWidget eq 'radiobuttons' }">
        <c:set var="widgetName" value="#{ 'Radio buttons' }"/>
      </c:when>
      <c:when test="#{ pWidget eq 'wysiwyg' }">
        <c:set var="widgetName" value="#{ 'WYSIWYG editor' }"/>
      </c:when>
    </c:choose>

    <span id="type-data" data-type-name="#{ pType }"/>

    <div class="type-info">
      <span class="lbl-type-info">Type: </span><span class="type-info-dat">#{ pType }</span>
    </div>

    <table id="tbl-fields" class="table table-striped">
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Widget</th>
          <th>Required</th>
          <th>Default</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <c:forEach var="field" items="#{ type.fields }">
          <tr>
            <td>#{ field.name }</td>
            <td>#{ field.jcrType }</td>
            <td>#{ field.widget }</td>
            <td>#{ field.required }</td>
            <td>#{ field.default }</td>
            <td class="field-buttons">
              <i class="btn-edit-field glyphicon glyphicon-edit" onclick="app.page.btnEditFieldClick('#{ field.name }')"/>
              <i class="btn-delete-field glyphicon glyphicon-remove" onclick="app.page.btnDeleteFieldClick('#{ field.name }')"/>
            </td>
          </tr>
        </c:forEach>
        <tr>
          <td>
            <i class="btn-new-field glyphicon glyphicon-plus" onclick="app.page.btnNewFieldClick()"/>
          </td>
          <td colspan="5"></td>
        </tr>
      </tbody>
    </table>

    <c:if test="#{ pField != null }">
      <div role="tabpanel">

        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active"><a href="#tab-field-def" role="tab" data-toggle="tab">Field</a></li>
          <li role="presentation"><a href="#tab-parser-params" role="tab" data-toggle="tab">#{ jcrTypeName } parser</a></li>
          <li role="presentation"><a href="#tab-widget-params" role="tab" data-toggle="tab">#{ widgetName } widget</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="tab-field-def">
            <form id="frm-field-def" class="form-horizontal">
              <div class="form-group">
                <label class="col-sm-1 control-label">Name</label>
                <div class="col-sm-11">
                  <input id="field-def-name" class="form-control" type="text" name="fieldName" data-bind="value: fieldName"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-1 control-label">Type</label>
                <div class="col-sm-11">
                  <select id="field-def-type" class="form-control" name="type" onchange="app.page.onJcrTypeSelection(this)" data-bind="value: type">
                    <option value="#{ jcrBean.binary }">binary</option>
                    <option value="#{ jcrBean.boolean }">boolean</option>
                    <option value="#{ jcrBean.date }">date</option>
                    <option value="#{ jcrBean.double }">double</option>
                    <option value="#{ jcrBean.long }">long</option>
                    <option value="#{ jcrBean.string }">string</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-1 control-label">Widget</label>
                <div class="col-sm-11">
                  <select id="field-def-widget" class="form-control" name="widget" onchange="app.page.onWidgetSelection(this)" data-bind="value: widget">
                    <option value="textedit">textedit</option>
                    <option value="textarea">textarea</option>
                    <option value="datepicker">datepicker</option>
                    <option value="spinbox">spinbox</option>
                    <option value="checkbox">checkbox</option>
                    <option value="selector">selector</option>
                    <option value="radiobuttons">radio buttons</option>
                    <option value="wysiwyg">WYSIWYG editor</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <div class="col-sm-offset-1 col-sm-11">
                  <div class="checkbox">
                    <label>
                      <input id="field-def-required" type="checkbox" name="required" data-bind="checked: required"/>Required
                    </label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-1 control-label">Default</label>
                <div class="col-sm-11">
                  <input id="field-def-default" class="form-control" type="text" name="defaultValue" data-bind="value: defaultValue"/>
                </div>
              </div>
              <div class="form-group">
                <div class="col-sm-offset-1 col-sm-11">
                  <c:if test='#{ pField != null and pField != "[new]" }'>
                    <button type="button" class="btn btn-default" onclick="app.page.btnUpdateFieldClick()">Save changes</button>
                    <button type="button" class="btn btn-default" onclick="app.page.btnCancelFieldClick()">Cancel</button>
                  </c:if>
                  <c:if test='#{ pField == "[new]" }'>
                    <button type="button" class="btn btn-default" onclick="app.page.btnSaveNewFieldClick()">Save new</button>
                    <button type="button" class="btn btn-default" onclick="app.page.btnCancelFieldClick()">Cancel</button>
                  </c:if>
                </div>
              </div>
            </form>
          </div>
          <div role="tabpanel" class="tab-pane" id="tab-parser-params">
            <c:if test="#{ pJcrType != null }">
              <form id="frm-parser-params" class="form-horizontal">
                <c:choose>
                  <c:when test="#{ pJcrType eq jcrBean.binary }">
                    <!-- -->
                  </c:when>
                  <c:when test="#{ pJcrType eq jcrBean.boolean }">
                    <!-- -->
                  </c:when>
                  <c:when test="#{ pJcrType eq jcrBean.date }">
                    <div class="form-group">
                      <label class="col-sm-1 control-label">Format</label>
                      <div class="col-sm-11">
                        <input class="form-control" type="text" name="dateFormat" value="dd/MM/yyyy" data-bind="value: parserParams.dateFormat"/>
                      </div>
                    </div>
                  </c:when>
                  <c:when test="#{ pJcrType eq jcrBean.double }">
                    <!-- -->
                  </c:when>
                  <c:when test="#{ pJcrType eq jcrBean.long }">
                    <!-- -->
                  </c:when>
                  <c:when test="#{ pJcrType eq jcrBean.string }">
                    <!-- -->
                  </c:when>
                </c:choose>
              </form>
            </c:if>
          </div>
          <div role="tabpanel" class="tab-pane" id="tab-widget-params">
            <c:if test="#{ pWidget != null }">
              <form id="frm-widget-params" class="form-horizontal">
                <c:choose>
                  <c:when test="#{ pWidget eq 'textedit' }">
                    <!-- -->
                  </c:when>
                  <c:when test="#{ pWidget eq 'textarea' }">
                    <!-- -->
                  </c:when>
                  <c:when test="#{ pWidget eq 'datepicker' }">
                    <!-- -->
                  </c:when>
                  <c:when test="#{ pWidget eq 'spinbox' }">
                    <!-- -->
                  </c:when>
                  <c:when test="#{ pWidget eq 'selector' }">
                    <!-- -->
                  </c:when>
                  <c:when test="#{ pWidget eq 'checkbox' }">
                    <!-- -->
                  </c:when>
                  <c:when test="#{ pWidget eq 'radiobuttons' }">
                    <!-- -->
                  </c:when>
                  <c:when test="#{ pWidget eq 'wysiwyg' }">
                    <!-- -->
                  </c:when>
                </c:choose>
              </form>
            </c:if>
          </div>
        </div>
      </div>
    </c:if>
  </c:if>
</div>
